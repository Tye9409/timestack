// Generated by CoffeeScript 1.3.3
/*
Timestack
http://icambron.github.com/timestack
Copyright 2012 Isaac Cambron
Released under the MIT license, license here: https://github.com/icambron/timestack/blob/master/Readme.markdown
*/(function(){(function(e){return $.fn.extend({timestack:function(e){var t,n;n={click:null,parse:function(e){return moment(e)},renderDates:function(t){var n,r,i;return n=this.dateFormats[e.span],i=t.start.format(n),r=t.tilNow?"":t.end.format(n),this.formatRange(i,r)},formatRange:function(e,t){return""+e+" - "+t},span:"year",dateFormats:{year:"MMM YYYY",month:"MMM DD",day:"MMM DD",hour:"h:mm a"},intervalFormats:{year:"YYYY",month:"MMM YYYY",day:"MMM DD",hour:"h:mm a"}},e=$.extend(n,e);if(["year","month","day","hour"].indexOf(e.span)>-1)return t=function(t,n){var r,i;i=[],r=t.clone().startOf(e.span);while(r<n)i.push(r.clone()),r.add(e.span+"s",1);return i},this.each(function(){var n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S;i=$(this),s=i.children("ul"),s.css("width",e.width).addClass("timestack-events"),f=null,d=null,h=s.children("li").map(function(){var t,n,r;t=$(this),n=t.attr("data-end"),r={tilNow:!n,start:e.parse(t.attr("data-start")),end:e.parse(n),title:t.contents().filter(function(){return this.nodeType===3}).remove().text(),color:t.attr("data-color"),li:t};if(r.start<=r.end)return f&&f<r.start||(f=r.start.clone()),d&&d>r.end||(d=r.end.clone()),r;throw"Start times must be before end times"}),f.startOf(e.span),d.valueOf()!==d.clone().startOf(e.span).valueOf()&&d.endOf(e.span),a=d-f;for(b=0,E=h.length;b<E;b++)c=h[b],r=c.li,c.timeDisplay=e.renderDates(c),m=$("<em>("+c.timeDisplay+")</em>").addClass("timestack-time"),g=$("<span>"+c.title+" </span>").addClass("timestack-title"),p=$("<span></span>").addClass("timestack-label").append(g).append(m),c.content=r.children().wrapAll("<div class='timestack-content'></div>").parent().hide().children(),y=((c.end-c.start)/a*100).toFixed(2),v=((c.start-f)/a*100).toFixed(2),r.prepend(p).css("margin-left",""+v+"%").css("width",""+y+"%").click(function(t){return function(){return e.click(t)}}(c)),c.color&&r.css("background-color",c.color),e.click&&r.css("cursor","pointer");u=t(f,d),y=(100/u.length).toFixed(2)+"%",l=e.intervalFormats[e.span],n=$("<ul></ul>").addClass("intervals");for(w=0,S=u.length;w<S;w++)o=u[w],$("<li></li>").text(o.format(l)).css("width",y).appendTo(n);return i.append(n)});throw""+e.span+" is not a valid span option"}})})(jQuery)}).call(this);