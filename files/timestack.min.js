// Generated by CoffeeScript 1.3.3
/*
Timestack
http://icambron.github.com/timestack
Copyright 2012 Isaac Cambron
Released under the MIT license, license here: https://github.com/icambron/timestack/blob/master/Readme.markdown
*/((function(){(function(a){return $.fn.extend({timestack:function(a){var b,c;c={click:null,parse:function(a){return moment(a)},renderDates:function(b){var c,d,e;return c=this.dateFormats[a.span],e=b.start.format(c),d=b.tilNow?"":b.end.format(c),this.formatRange(e,d)},formatRange:function(a,b){return""+a+" - "+b},span:"year",dateFormats:{year:"MMM YYYY",month:"MMM DD",day:"MMM DD",hour:"h:mm a"},intervalFormats:{year:"YYYY",month:"MMM YYYY",day:"MMM DD",hour:"h:mm a"}},a=$.extend(c,a);if(["year","month","day","hour"].indexOf(a.span)>0)return b=function(b,c){var d,e;e=[],d=b.clone().startOf(a.span);while(d<c)e.push(d.clone()),d.add(a.span+"s",1);return e},this.each(function(){var c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w;e=$(this),f=e.children("ul"),f.css("width",a.width).addClass("timestack-events"),j=null,o=null,m=f.children("li").map(function(){var b,c,d;b=$(this),c=b.attr("data-end"),d={tilNow:!c,start:a.parse(b.attr("data-start")),end:a.parse(c),title:b.contents().filter(function(){return this.nodeType===3}).remove().text(),color:b.attr("data-color"),li:b};if(d.start<=d.end)return j&&j<d.start||(j=d.start.clone()),o&&o>d.end||(o=d.end.clone()),d;throw"Start times must be before end times"}),j.startOf(a.span),o.valueOf()!==o.clone().startOf(a.span).valueOf()&&o.endOf(a.span),i=o-j;for(t=0,v=m.length;t<v;t++)l=m[t],d=l.li,l.timeDisplay=a.renderDates(l),q=$("<em>("+l.timeDisplay+")</em>").addClass("timestack-time"),r=$("<span>"+l.title+" </span>").addClass("timestack-title"),n=$("<span></span>").addClass("timestack-label").append(r).append(q),l.content=d.children().wrapAll("<div class='timestack-content'></div>").parent().hide().children(),s=((l.end-l.start)/i*100).toFixed(2),p=((l.start-j)/i*100).toFixed(2),d.prepend(n).css("margin-left",""+p+"%").css("width",""+s+"%").click(function(b){return function(){return a.click(b)}}(l)),l.color&&d.css("background-color",l.color),a.click&&d.css("cursor","pointer");h=b(j,o),s=(100/h.length).toFixed(2)+"%",k=a.intervalFormats[a.span],c=$("<ul></ul>").addClass("intervals");for(u=0,w=h.length;u<w;u++)g=h[u],$("<li></li>").text(g.format(k)).css("width",s).appendTo(c);return e.append(c)});throw""+a.span+" is not a valid span option"}})})(jQuery)})).call(this);